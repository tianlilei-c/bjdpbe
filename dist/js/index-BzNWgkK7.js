var c=(u,d,m)=>new Promise((n,h)=>{var $=v=>{try{g(m.next(v))}catch(_){h(_)}},x=v=>{try{g(m.throw(v))}catch(_){h(_)}},g=v=>v.done?n(v.value):Promise.resolve(v.value).then($,x);g((m=m.apply(u,d)).next())});import{u as V}from"./vxe-table-CPeNq2vn.js";import{bB as C,$ as w,bC as b,bz as f}from"./bootstrap-BHWmWfJw.js";import q from"./index-mQRJpXPa.js";import{T as A}from"./index-n89Ej1JE.js";import{F as k}from"./index-B8FfuKO4.js";import U from"./index-BRHdDS3n.js";import{_ as j}from"./page.vue_vue_type_script_setup_true_lang-lnQK_7D5.js";import{a4 as E,P as z,aa as S,ab as P,ac as l,x as r,a7 as s,aq as I,ai as y,aw as G,aj as M}from"../jse/index-index-a2lIU8i0.js";import"./css-Dmgy8YJo.js";import"./useMergedState-Rvg0HEPv.js";import"./EyeOutlined-D9BjerTM.js";import"./useFlexGapSupport-BYc9Kf_P.js";import"./colors-BXapAcvs.js";import"./Trigger-BWmxoctH.js";import"./ResizeObserver.es-CDE7jhPe.js";import"./hasIn-B6tW1hdh.js";import"./isPlainObject-CC8e-920.js";import"./collapse-BuqCI_Sc.js";import"./index-DM7hDkMD.js";import"./collapseMotion-oQ_Qcp1t.js";import"./FormItemContext-VOKTS-Oe.js";import"./statusUtils-B6L_8whL.js";import"./BaseInput-Cu4cyaaW.js";import"./index-CPrDVAs8.js";import"./SearchOutlined-CBEZIQv6.js";import"./index-DzG_grUi.js";function R(u){return c(this,null,function*(){return C.get("/auth/users/",{params:u})})}function H(u){return c(this,null,function*(){return C.post("/auth/users/",u)})}function O(u,d){return c(this,null,function*(){return C.put(`/auth/users/${u}/`,d)})}function J(u){return c(this,null,function*(){return C.delete(`/auth/users/${u}/`)})}function K(u,d){return c(this,null,function*(){return C.post(`/auth/users/${u}/reset_password/`,d)})}const Ce=E({__name:"index",setup(u){const d=z(!1),m=z(null),n=z({username:"",password:"",real_name:"",email:"",roles:"admin"});function h(){n.value={username:"",password:"",real_name:"",email:"",roles:"admin"}}const $={columns:[{title:"序号",type:"seq",width:80},{field:"username",title:"用户名",width:120},{field:"real_name",title:"真实姓名",width:120},{field:"email",title:"邮箱",width:200},{field:"roles",title:"角色",width:100,slots:{default:"roles"}},{field:"is_active",title:"状态",width:100,slots:{default:"status"}},{field:"created_at",title:"创建时间",width:180,formatter:({cellValue:a})=>a?new Date(a).toLocaleString("zh-CN"):""},{field:"last_login",title:"最后登录",width:180,formatter:({cellValue:a})=>a?new Date(a).toLocaleString("zh-CN"):""},{fixed:"right",slots:{default:"action"},title:"操作",width:200}],height:600,keepSource:!0,pagerConfig:{enabled:!0,pageSize:20},proxyConfig:{ajax:{query:t=>c(null,[t],function*({page:a}){try{const e=yield R({page:a.currentPage,page_size:a.pageSize});return{items:e.results||[],total:e.count||0}}catch(e){return console.error("获取用户列表失败:",e),{items:[],total:0}}})},enabled:!0,response:{result:"items",total:"total"},autoLoad:!0},toolbarConfig:{enabled:!0,refresh:!0,slots:{buttons:"toolbar-buttons"}}},[x,g]=V({gridOptions:$});function v(){g.query(),f.success("用户列表刷新成功")}function _(){m.value=null,h(),d.value=!0}function B(a){m.value=a,n.value={username:a.username||"",password:"",real_name:a.real_name||"",email:a.email||"",roles:a.roles||"admin"},d.value=!0}function N(){return c(this,null,function*(){var a,t;try{m.value?(yield O(m.value.id,{real_name:n.value.real_name,email:n.value.email,roles:n.value.roles}),f.success("用户更新成功")):(yield H({username:n.value.username,password:n.value.password,real_name:n.value.real_name,email:n.value.email,roles:n.value.roles}),f.success("用户创建成功")),d.value=!1,g.query()}catch(e){const i=((t=(a=e==null?void 0:e.response)==null?void 0:a.data)==null?void 0:t.message)||(e==null?void 0:e.message)||"操作失败";f.error(i)}})}function D(a){return c(this,null,function*(){const t=!a.is_active,e=t?"启用":"禁用";b.confirm({title:`确认${e}用户`,content:`确定要${e}用户 "${a.username}" 吗？`,onOk:()=>c(null,null,function*(){var i,o;try{yield O(a.id,{is_active:t}),f.success(`用户${e}成功`),g.query()}catch(p){const T=((o=(i=p==null?void 0:p.response)==null?void 0:i.data)==null?void 0:o.message)||(p==null?void 0:p.message)||`用户${e}失败`;f.error(T)}})})})}function F(a){b.confirm({title:"重置密码",content:`确定要重置用户 "${a.username}" 的密码吗？请输入新密码。`,onOk:()=>c(null,null,function*(){var e,i;const t=yield new Promise(o=>{b.confirm({title:"输入新密码",content:`
            <div>
              <label>新密码:</label>
              <input type="password" id="newPassword" style="width: 100%; margin-top: 8px; padding: 4px 8px; border: 1px solid #ccc; border-radius: 4px;" />
            </div>
          `,onOk:()=>{const p=document.getElementById("newPassword");o((p==null?void 0:p.value)||"")},onCancel:()=>o("")})});if(t&&t.length>=6)try{yield K(a.id,{new_password:t}),f.success("密码重置成功")}catch(o){const p=((i=(e=o==null?void 0:o.response)==null?void 0:e.data)==null?void 0:i.message)||(o==null?void 0:o.message)||"密码重置失败";f.error(p)}else t&&f.error("密码长度至少6位")})})}function L(a){if(a.username==="admin"){f.warning("不能删除管理员账户");return}b.confirm({title:"确认删除",content:`确定要删除用户 "${a.username}" 吗？此操作不可恢复。`,onOk:()=>c(null,null,function*(){var t,e;try{yield J(a.id),f.success("用户删除成功"),g.query()}catch(i){const o=((e=(t=i==null?void 0:i.response)==null?void 0:t.data)==null?void 0:e.message)||(i==null?void 0:i.message)||"用户删除失败";f.error(o)}})})}return(a,t)=>(P(),S(s(j),{description:"管理系统用户账户，包括添加、编辑、禁用等操作",title:"用户管理"},{default:l(()=>[r(s(x),null,{"toolbar-buttons":l(()=>[r(s(q),null,{default:l(()=>[r(s(w),{type:"primary",onClick:_},{default:l(()=>t[6]||(t[6]=[y(" 添加用户 ")])),_:1}),r(s(w),{onClick:v},{default:l(()=>t[7]||(t[7]=[y(" 刷新列表 ")])),_:1})]),_:1})]),roles:l(({row:e})=>[r(s(A),{color:"red"},{default:l(()=>t[8]||(t[8]=[y(" 管理员 ")])),_:1})]),status:l(({row:e})=>[r(s(A),{color:e.is_active?"green":"default"},{default:l(()=>[y(M(e.is_active?"正常":"禁用"),1)]),_:2},1032,["color"])]),action:l(({row:e})=>[r(s(q),null,{default:l(()=>[r(s(w),{size:"small",type:"link",onClick:i=>B(e)},{default:l(()=>t[9]||(t[9]=[y(" 编辑 ")])),_:2},1032,["onClick"]),r(s(w),{size:"small",type:"link",style:G({color:e.is_active?"#ff4d4f":"#52c41a"}),onClick:i=>D(e)},{default:l(()=>[y(M(e.is_active?"禁用":"启用"),1)]),_:2},1032,["style","onClick"]),r(s(w),{size:"small",type:"link",onClick:i=>F(e)},{default:l(()=>t[10]||(t[10]=[y(" 重置密码 ")])),_:2},1032,["onClick"]),e.username!=="admin"?(P(),S(s(w),{key:0,danger:"",size:"small",type:"link",onClick:i=>L(e)},{default:l(()=>t[11]||(t[11]=[y(" 删除 ")])),_:2},1032,["onClick"])):I("",!0)]),_:2},1024)]),_:1}),r(s(b),{open:d.value,"onUpdate:open":t[4]||(t[4]=e=>d.value=e),title:m.value?"编辑用户":"添加用户",onOk:N,onCancel:t[5]||(t[5]=e=>d.value=!1)},{default:l(()=>[r(s(k),{layout:"vertical",style:{"margin-top":"16px"}},{default:l(()=>[r(s(k).Item,{label:"用户名"},{default:l(()=>[r(s(U),{value:n.value.username,"onUpdate:value":t[0]||(t[0]=e=>n.value.username=e),disabled:!!m.value,placeholder:"请输入用户名"},null,8,["value","disabled"])]),_:1}),m.value?I("",!0):(P(),S(s(k).Item,{key:0,label:"密码"},{default:l(()=>[r(s(U).Password,{value:n.value.password,"onUpdate:value":t[1]||(t[1]=e=>n.value.password=e),placeholder:"请输入密码"},null,8,["value"])]),_:1})),r(s(k).Item,{label:"真实姓名"},{default:l(()=>[r(s(U),{value:n.value.real_name,"onUpdate:value":t[2]||(t[2]=e=>n.value.real_name=e),placeholder:"请输入真实姓名"},null,8,["value"])]),_:1}),r(s(k).Item,{label:"邮箱"},{default:l(()=>[r(s(U),{value:n.value.email,"onUpdate:value":t[3]||(t[3]=e=>n.value.email=e),placeholder:"请输入邮箱"},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["open","title"])]),_:1}))}});export{Ce as default};
